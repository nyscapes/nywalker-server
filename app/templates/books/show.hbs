<div class="card" style="width: 33rem">
  <h1 class="card-header">
    <em>{{model.title}}</em>
  </h1>
  {{#leaflet-map center=center zoom=zoom class="map card-img-top" as |layers|}}
    {{layers.tile url="http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"}}
    {{#each instancePlaces as |place|}}
      {{#circle-marker-layer radius=5 location=place.latLng}}
        {{#popup-layer}}
          <h4>{{place.place_name}}</h4>
          <table class="table-sm table">
            <thead class="thead-inverse">
              <tr>
                <th>Total Instances:</th>
                <th>{{place.totalInstances.count}}</th>
              </tr>
            </thead>
            <tbody>
              {{#each place.nicknames as |nickname|}}
                <tr>
                  <td> {{nickname.text}} </td>
                  <td> {{nickname.count}} </td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        {{/popup-layer}}
      {{/circle-marker-layer}}
    {{/each}}
  {{/leaflet-map}}

  <div class="card-block">
    <h4>Download instances as:</h4>
      <span class="btn-group" role="group">
        <a href="/books/{{model.slug}}/instances-geojson" class="btn btn-secondary btn-sm" role="button">GeoJSON</a>
        <a href="/books/{{model.slug}}/instances-csv" class="btn btn-secondary btn-sm" role="button">.csv</a>
        <a href="http://oneclick.cartodb.com/?file={{baseUrl}}/books/{{model.slug}}/instances-geojson" class="btn btn-secondary btn-sm" role="button">Send to Carto</a>
      </span>
    <h4>Download places as: <br />
      <span class="btn-group" role="group">
        <a href="/books/{{model.slug}}/places-geojson" class="btn btn-secondary btn-sm" role="button">GeoJSON</a>
        <a href="/books/{{model.slug}}/places-csv" class="btn btn-secondary btn-sm" role="button">.csv</a>
        <a href="http://oneclick.cartodb.com/?file={{baseUrl}}/books/{{model.slug}}/places-geojson" class="btn btn-secondary btn-sm" role="button">Send to Carto</a>
        <a href="/books/{{model.slug}}/places-special-csv-zip" class="btn btn-secondary btn-sm" role="button">.zip of special.csvs</a>
      </span>
    </h4>
    <div class="container">
      <div class="row">
        <div class="col-1">
          <b>Pg</b>
        </div>
        <div class="col-1">
          <b>Seq</b>
        </div>
        {{#if model.special}}
          <div class="col-6">
            <b>Name in Text</b>
          </div>
          <div class="col-4">
            <b>Special</b>
          </div>
        {{else}}
          <div class="col-10">
            <b>Name in Text <small>({{fa-icon "globe"}} = mappable)</small></b>
          </div>
        {{/if}} 
      </div>

      {{#each sortedInstances as |instance|}}
        <div class="row">
          <div class="col-1">
            {{instance.page}}
          </div>
          <div class="col-1">
            {{instance.sequence}}
          </div>
          {{#if model.special}}
            <div class="col-6">
              {{instance.text}} {{#if instance.mappable}}
              <a {{action "recenter" instance.latLng target="layers"}}>
                {{fa-icon "globe"}}
              </a>
              {{/if}}
            </div>
            <div class="col-4">
              {{instance.special}}
            </div>
          {{else}}
            <div class="col-10">
              {{instance.text}} {{#if instance.mappable}}
              <a {{action "recenter" instance.latLng}}>
                {{fa-icon "globe"}}
              </a>
              {{/if}}
            </div>
          {{/if}} 
        </div>
      {{/each}}
    </div> <!-- .container -->
{{outlet}}
  </div>
</div>
